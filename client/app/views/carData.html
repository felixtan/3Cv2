<link rel="stylesheet" type="text/css" href="styles/tables.css">

<tabset>
    <tab ng-repeat='tab in tabs' heading='{{ ::tab.title }}' active='tab.active' ui-sref='{{ ::tab.state }}'>
    </tab>
</tabset>

<br>

<div class='btn-toolbar' role='toolbar'>
    <div class='btn-group' role='group'>
        <button class='btn btn-success' ng-click='addField()'>
            + Field
        </button>
    </div>
    
    <!-- <div class='btn-group' role='group' style='float:right;'>
        <button class='btn btn-danger' role='group' ng-click='open(prospect.id)' ng-controller='DeleteObjModalCtrl'>
            Delete
        </button>
    </div> -->
</div>

<br>

<div class='table-responsive table-bordered'>
    <table class='table'>
        <thead>
            <tr>
                <th>Field</th>
                <th>Value</th>
                <th>Logged</th>
                <th>Identifier</th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody>
            <!-- non expressions -->
            <!-- TODO: only allow these to be identifiers? -->
            <tr ng-repeat='(field, data) in car.data' ng-if='data.type !== "function" && data.type !== "inequality"'>
                <td>
                    <span id='{{ field }}' class='field-name' editable-text='field' e-name='name' e-form='rowform' onbeforesave='checkFieldName($data, field)'>
                        {{ field }}
                    </span>
                </td>
                <td>
                    <span editable-text='data.value' e-name='value' e-form='rowform' onbeforesave='checkFieldValue($data, data.value)'>
                        {{ data.value }}
                    </span>
                </td>
                <td>
                    <i class='fa fa-check' ng-if='data.log && !rowform.$visible'></i>
                    <input type='checkbox' editable-checkbox='data.log' e-name='log' e-form='rowform' ng-show='rowform.$visible' onbeforesave='checkLogValue($data, data.log)'></input>                 
                </td>
                <td>
                    <i class='fa fa-check' ng-if='field === currentIdentifier.name && !rowform.$visible'></i>
                    <input type='radio' e-name='identifier' value='{{ field }}' e-form='rowform' ng-model='identifier.name' ng-show='rowform.$visible' onbeforesave='checkIdentifierValue($data, currentIdentifier.name)'></input>
                </td>
                <td style='white-space: nowrap'>
                    <div class='btn-toolbar btn-edit' role='toolbar'>
                        <form editable-form name='rowform' onaftersave='save($data, field)' ng-show='rowform.$visible' class='form-buttons form-inline'>
                            <button type='submit' ng-disabled='rowform.$waiting' class='btn btn-success btn-xs'>
                                Save
                            </button>
                            <button type='button' ng-disabled='rowform.$waiting' ng-click='rowform.$cancel()' class='btn btn-default btn-xs'>
                                Cancel
                            </button>
                            <button class='btn btn-danger btn-xs' style='margin-left:1vw' data-toggle='modal' ng-click='open(lg, { "field": field })' ng-controller='DeleteFieldModalCtrl'>
                                Delete
                            </button>
                        </form>
                    </div>
                    <div class='buttons' ng-show='!rowform.$visible'>
                        <button class='btn btn-warning btn-xs' ng-click='rowform.$show()'>Edit</button>
                    </div>
                </td>
            </tr>

            <!-- functions -->
            <tr ng-repeat='(field, data) in car.data' ng-if='data.type === "function"'>
                <td>
                    <span id='{{ field }}' class='field-name' editable-text='field' e-name='name' e-form='rowform' onbeforesave='checkFieldName($data, field)'>
                        {{ field }}
                    </span>
                </td>
                <td>
                    <span editable-text='data.value' e-name='value' e-form='rowform' onbeforesave='checkFieldValue($data, data.value)'>
                        {{ data.value | number : 2 }}
                    </span>
                </td>
                <td>
                    <i class='fa fa-check' ng-if='data.log && !rowform.$visible'></i>
                    <input type='checkbox' editable-checkbox='data.log' e-name='log' e-form='rowform' ng-show='rowform.$visible' onbeforesave='checkLogValue($data, data.log)'></input>                 
                </td>
                <td>
                    <i class='fa fa-check' ng-if='field === currentIdentifier.name && !rowform.$visible'></i>
                    <input type='radio' e-name='identifier' value='{{ field }}' e-form='rowform' ng-model='identifier.name' ng-show='rowform.$visible' onbeforesave='checkIdentifierValue($data, currentIdentifier.name)'></input>
                </td>
                <td style='white-space: nowrap'>
                    <div class='btn-toolbar btn-edit' role='toolbar'>
                        <form editable-form name='rowform' onaftersave='save($data, field)' ng-show='rowform.$visible' class='form-buttons form-inline'>
                            <button type='submit' ng-disabled='rowform.$waiting' class='btn btn-success btn-xs'>
                                Save
                            </button>
                            <button type='button' ng-disabled='rowform.$waiting' ng-click='rowform.$cancel()' class='btn btn-default btn-xs'>
                                Cancel
                            </button>
                            <button class='btn btn-danger btn-xs' style='margin-left:1vw' data-toggle='modal' ng-click='open(lg, { "field": field })' ng-controller='DeleteFieldModalCtrl'>
                                Delete
                            </button>
                        </form>
                    </div>
                    <div class='buttons' ng-show='!rowform.$visible'>
                        <button class='btn btn-warning btn-xs' ng-click='rowform.$show()'>Edit</button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <!-- {{ car.data }} -->
</div>

<br>

<!-- Driver Assignment UI -->
<h3>Driver<span ng-if='(car.driversAssigned > 1) || (car.driversAssigned === 0)'>s</span> Assigned</h3>

<div class='btn-toolbar' role='toolbar'>
    <div class='btn-group' role='group'>
        <button class='btn btn-success' ng-click='assign("driver")'>+ Driver</button>
    </div>
</div>

<br>

<div class='table-responsive table-bordered'>
    <table class='table'>
        <thead>
            <tr>
                <th>Name</th>
                <th>Date Assigned</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat='driver in car.driversAssigned | orderBy:"dateAssigned"' ui-sref='driverProfile.data({ id: driver.id })' class='table-row-link'>
                <td>{{ ::driver.identifier }}</td>
                <td>{{ ::driver.dateAssigned | date: 'fullDate' }}<span ng-if='driver.dateUnassigned !== null'> - {{ ::driver.dateEnded | date: 'fullDate' }}</span></td>
            </tr>
        </tbody>
    </table>
</div>