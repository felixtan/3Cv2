<link rel="stylesheet" href='styles/forms.scss'>
<link rel='stylesheet' href='styles/addFieldModal.css'>

<div class="modal-header">
    <h3 class="modal-title">Add field</h3>
    <button type="button" class='close' ng-click='close()' style='margin-top:-35px;'>
        &times;
    </button>
</div>
<!-- {{ assetType }} -->
<!-- {{ field }} -->
<!-- {{ objects }}? -->
<!-- {{ field}} -->
<!-- {{ functionFieldSelect }} -->
<div class="modal-body">
    <form novalidate role='form' name='form' ng-submit='submit()'>

        <!-- Choose field type -->
        <div class='form-group'>
            <div class='alert alert-info'>
                <h4 class='control-label'>Type of field</h4>
                <ul class='fieldTypes'>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.type' value='text' type='radio' ng-change='setDataType(field)'>Text
                            <!-- <i class="fa fa-question-circle" tooltip=""></i> -->
                        </label>
                    </li>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.type' value='number' type='radio' ng-change='setDataType(field)'>Number
                            <!-- <i class="fa fa-question-circle" tooltip=""></i> -->
                        </label>
                    </li>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.type' value='boolean' type='radio' ng-change='setDataType(field)'>Boolean
                            <i class="fa fa-question-circle" tooltip="ex. yes/no, true/false"></i>
                        </label>
                    </li>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.type' value='function' type='radio' ng-change='setDataType(field)'> Function
                            <i class="fa fa-question-circle" tooltip="Outputs a value in terms of other functions and numbers"></i>
                        </label>
                    </li>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.type' value='inequality' type='radio' ng-change='setDataType(field)'> Inequality
                            <i class="fa fa-question-circle" tooltip="Compares two values and returns a true or false value"></i>
                        </label>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Choose field data type -->
        <!-- SHOW ONLY WHEN FIELD TYPE IS CHOSEN -- >
        <!-- Function implies Number -->
        <!-- Boolean implies Boolean -->
        <!-- Therefore, this radio list is obly shown for Variable/Constant field type -->
        <!-- TODO: SET correct dataType when field type is function or boolean -->
        <div class='form-group' ng-show='field.type === "variable"'>
            <div class='alert alert-info'>
                <ul class='fieldTypes'>
                    <label class='control-label'>Field data type</label>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.dataType' value='number' type='radio'>Number
                            <i class="fa fa-question-circle" tooltip='ex. 1234567890'></i>
                        </label>
                    </li>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.dataType' value='text' type='radio'> Text
                            <i class="fa fa-question-circle" tooltip='ex. The quick brown fox jumps over the lazy dog.'></i>
                        </label>
                    </li>
                    <li>
                        <label class='radio'>
                            <input ng-model='field.dataType' value='boolean' type='radio'> Boolean
                            <i class="fa fa-question-circle" tooltip='ex. true/false, yes/no'></i>
                        </label>
                    </li>
                </ul>
            </div>
        </div>

        <div class='form-group'>
            <label for='field'>Name</label>

            <input name='field' type='text' class='form-control' ng-model='field.name' ng-required='true' ng-pattern="/^[a-zA-Z0-9_]*$/">
        </div>

        <div class='form-group' ng-show='field.type === "variable"'>
            <label for='value'>Value</label>
            <input name='value' class='form-control' ng-model='formData.value'>
        </div>

        <!-- Function input -->
        <!-- Validation: 
            1. Function cannot begin nor end with an operator 
            2. Corollary: It must begin and end with a function/variable/constant
        -->
        <div class='form-group' ng-show='field.type === "function"'>
            <div class='well'>
                <h4>Function creator</h4><br>

                <h5 class='function'>{{ field.expression }}</h5><br>
                
                <div class='btn-toolbar' role='toolbar'>

                    <button class='btn btn-warning operator' type='button' ng-click='appendItemToFunction("+", "operator")'>+</button>

                    <button class='btn btn-warning operator' type='button' ng-click='appendItemToFunction("-", "operator")'>-</button>
                    
                    <button class='btn btn-warning operator' type='button' ng-click='appendItemToFunction("*", "operator")'>*</button>

                    <button class='btn btn-warning operator' type='button' ng-click='appendItemToFunction("/", "operator")'>/</button>

                    <button class='btn btn-warning operator' type='button' ng-click='appendItemToFunction("(", "operator")'>(</button>

                    <button class='btn btn-warning operator' type='button' ng-click='appendItemToFunction(")", "operator")'>)</button>

                    <div class='undoAndClear'>
                        <button class='btn btn-primary undo' type='button' ng-click='undoFunction()'>Undo</button>
                        <button class='btn btn-danger clear' type='button' ng-click='clearFunction()'>Clear</button>
                    </div>
                </div><br>

                <label>
                    Constant
                    <i class="fa fa-question-circle" tooltip='Add a constant number to the function'></i>
                </label>
                <div class="input-group">
                    <span class="input-group-btn">
                        <button class="btn" type="button" ng-click='appendItemToFunction(functionConstantInput.value, "constant")' ng-disabled='form.functionConst.$dirty && form.functionConst.$invalid'>+</button>
                    </span>
                    <input name='functionConst' type="text" class="form-control" ng-model='functionConstantInput.value' ng-pattern="/^[0-9]\d*(\.\d+)?$/">
                    <!-- regex patterns for constant -->
                    <!-- ^[1-9]\d*(\.\d+)?$ -->
                    <!-- /^[0-9]*$/ -->
                </div><br><!-- /input-group -->

                <label>
                    Fields
                    <i class="fa fa-question-circle" tooltip='Add an existing field to the function'></i>
                </label>
                <select class='form-control' ng-model='functionFieldSelect.value' ng-change='appendItemToFunction(functionFieldSelect.value, "field")'>
                    <option ng-repeat='(field, data) in objects[0].data' value='{{ ::field }}' ng-if='data.dataType === "number"'>{{ ::field }}</option>
                </select>
            </div>
        </div>

        <div ng-messages="form.field.$error" ng-show='form.field.$dirty && form.field.$invalid' class="alert alert-danger" role="alert">
            <div>
                Field must
                <ul>
                    <li>be alphanumeric</li>
                    <li>contain no special characters except _</li>
                    <li>contain no spaces</li>
                </ul>
            </div>
        </div>

        <div ng-messages="form.functionConst.$error" ng-show='form.functionConst.$dirty && form.functionConst.$invalid' class="alert alert-danger" role="alert">
            <div>
                Constant must
                <ul>
                    <li>be a number</li>
                    <li>include at least one digit following a decimal point</li>
                </ul>
            </div>
        </div>

        <div ng-if='!validFunction' class="alert alert-danger" role="alert">
            <div id='expression-error-message' ng-if='expressionErrorMessage'>
                <h4>Function error(s):</h4>
                <ul>
                    <li>{{ expressionErrorMessage }}</li>
                </ul>
            </div>
            <br>
            <div id='general-expression-rules'>
                <h4>Function must</h4>
                <ul>
                    <li>not end or begin with a mathematical operator</li>
                    <li>contain a mathematical operator between any two values</li>
                    <li>not contain unclosed parentheses</li>
                </ul>
            </div>
        </div>

    </form>
</div>

<div class="modal-footer">
    <!-- {{ form.field.$invalid }}
    {{ invalidFieldType() }}
    {{ !validFunction }} -->
    <!-- {{ field }} -->
    <button class="btn btn-success" type="button" ng-click="submit()" ng-disabled='form.field.$invalid || invalidFieldType() || !validFunction'>Submit</button>
    <button class="btn btn-danger" type="button" ng-click="reset()">Reset</button>
    <button class='btn btn-default' type='button' ng-click='close()'>Close</button>
</div>
