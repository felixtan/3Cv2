<link rel="stylesheet" href="styles/partials/logs.cars.css">

<div class='col-md-10 col-md-offset-2 col-sm-offset-3'>
    <h1 class='page-header'>Car Logs</h1>

    <div class='btn-toolbar log-toolbar' role='toolbar'>
        <div class='btn-group' role='group'>
            <button class='btn btn-success' ng-click='logctrl.newLog()' ng-disabled='dt.getDay() !== getStartingDayNum()'> 
                + Log 
            </button>
        </div>
        <div class='btn-group' role='group'>
           <div class="input-group car-log-toolbar">
                <input type="text" 
                    class="form-control" 
                    datepicker-popup="{{format}}" 
                    ng-model="dt" 
                    is-open="status.opened" 
                    max-date="maxDate" 
                    datepicker-options="dateOptions"  
                    ng-required="true" 
                    close-text="Close" /> 
                <div class="input-group-btn">
                    <button type="button" class="btn btn-primary" ng-click="open($event)">
                        <i class="fa fa-calendar"></i>
                    </button>
                </div>   
            </div>
        </div>
        <div class='btn-group' role='group'>
            <p id='datepicker-instructions'>
                * Choose the {{ getStartingDayWord() }} of the week to be logged.
            </p>
        </div>
    </div>
    <div>most recent log: {{ mostRecentLogDate | date:'longDate' }}</div>
    <br>

    <div class="table-responsive" ng-model='cars'>
        <table class="table table-bordered table-striped table-hover">
            <thead>
                <tr>
                    <td><strong>Week \ Car</strong></td>
                    <td ng-repeat="car in cars | orderBy:'id'">
                        {{ car.data.licensePlate.value }}
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat='date in dates' ng-model='date'>
                    <td>
                        {{ date | date:'longDate' }}
                        <button class='btn btn-warning btn-xs' ng-click='logform.$show()' ng-show='!logform.$visible'>
                            Edit
                        </button>
                        <form editable-form name="logform" ng-show="logform.$visible" class="form-buttons form-inline" onaftersave='logctrl.save(date)'>
                            <button type="submit" ng-disabled="logform.$waiting" class="btn btn-primary btn-xs">
                                Save
                            </button>
                            <button type="button" ng-disabled="logform.$waiting" ng-click="logform.$cancel()" class="btn btn-default btn-xs">
                                Cancel
                            </button>
                        </form>
                    </td>
                    <td ng-repeat='car in cars'>
                        <ul ng-repeat='log in car.logs' ng-if='log.weekOf === date' class='log'>
                            <li ng-repeat='(field, value) in log.data'>
                                <p ng-show='logform.$visible'>{{ field }}: </p>
                                <span editable-text='log.data.{{ field }}' e-name='{{ field }}' e-form='logform' e-required>
                                    {{ field }}: {{ value }}
                                </span>
                            </li>
                            {{ log }}
                        </ul>
                    </td>
                </tr>
                <!-- <tr ng-repeat="car in logctrl.cars | orderBy:'-dateInMs'">
                    <td>
                        <span>{{ log.date | date : format : shortDate }}</span>
                        <button class='btn btn-warning btn-xs edit-btn' ng-click='logform.$show()' ng-show='!logform.$visible'>
                            Edit
                        </button>
                        <form editable-form name="logform" ng-show="logform.$visible" class="form-buttons form-inline" shown="false">
                          <button type="submit" ng-disabled="logform.$waiting" class="btn btn-primary btn-xs">
                            Save
                          </button>
                          <button type="button" ng-disabled="logform.$waiting" ng-click="logform.$cancel()" class="btn btn-default btn-xs">
                            Cancel
                          </button>
                        </form>
                    </td>
                    <td class='log-tablecell' ng-repeat="car in log.CarLogs | orderBy:'carId'">
                        <ul class='log'>
                            <li>
                                <p ng-show='logform.$visible'>Mileage: </p>
                                <span editable-text='car.mileage' e-name='mileage' e-form='logform' onaftersave='logctrl.updateLog(car)' e-required>
                                    Mileage: {{ car.mileage || ' ' }}
                                </span>
                            </li>
                            <li class='li-notes'>
                                <p ng-show='logform.$visible'>Notes: </p>
                                <span class='note' editable-textarea='car.note' e-name='note' e-form='logform' e-required>
                                    Notes: {{ car.note || ' '}}
                                </span>
                            </li>
                        </ul>
                    </td>
                </tr> -->
            </tbody>
        </table>
    </div>
</div>