<link rel="stylesheet" href="styles/partials/logs.css">

<div class='col-md-10 col-md-offset-2 col-sm-offset-3'>
    <div class='sub-header'>
        <h2>Asset Logs</h2>
    </div>
    <!-- {{ simpleAssets }} -->
    <!-- {{ assets }} -->
    <!-- {{ assetType }} -->
    <!-- {{ invalidAssetType() }} -->
    <div>
        <tabset>
            <!--  active='tab.active' -->
            <tab ng-repeat='tab in tabs' heading='{{ ::tab.title }}' select='renderLogs(tab.title)'></tab>
        </tabset>

        <br>

        <div class='btn-toolbar' role='toolbar'>
            <div class='btn-group' role='group'>
                <button class='btn btn-success' ng-click='newLog(assetType)' ng-disabled='(dt.getDay() !== getStartingDayNum()) || invalidAssetType()'>
                    + Log 
                </button>
            </div>
            <div class='btn-group' role='group'>
               <div class="input-group date-picker">
                    <input type="text" 
                        class="form-control" 
                        datepicker-popup="{{format}}" 
                        ng-model="dt" 
                        is-open="status.opened" 
                        max-date="maxDate" 
                        datepicker-options="dateOptions"  
                        ng-required="true" 
                        close-text="Close" /> 
                    <div class="input-group-btn">
                        <button type="button" class="btn btn-primary" ng-click="open($event)">
                            <i class="fa fa-calendar"></i>
                        </button>
                    </div>   
                </div>
            </div>
            <div class='btn-group' role='group'>
                <p id='datepicker-instructions'>
                    * Choose the {{ ::getStartingDayWord() }} of the week to be logged.
                </p>
            </div>
        </div>
        <!-- <div>most recent log: {{ mostRecentLogDate | date:'longDate' }}</div> -->
        <br>

        <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover">
                <thead>
                    <tr>
                        <td><strong>Week \ {{ assetType }}</strong></td>
                        <td ng-repeat="asset in simpleAssets | orderBy:'id'">
                            <a ui-sref='assetProfile.logs({ type: asset.assetType, id: asset.id })'>
                                {{ asset.identifierValue }}
                            </a>
                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat='date in dates'>
                        <td>
                            <span class='log-date'>
                                {{ ::date | date:'longDate' }}
                            </span>
                            <button class='btn btn-warning btn-xs' ng-click='logform.$show()' ng-show='!logform.$visible'>
                                Edit
                            </button>
                            <div class='btn-toolbar' role='toolbar'>
                                <form editable-form name="logform" ng-show="logform.$visible" class="form-buttons form-inline" onaftersave='save(date)'>
                                    <button type="submit" ng-disabled="logform.$waiting" class="btn btn-success btn-xs">
                                        Save
                                    </button>
                                    <button type="button" ng-disabled="logform.$waiting" ng-click="logform.$cancel()" class="btn btn-default btn-xs">
                                        Cancel
                                    </button>
                                    <button class='btn btn-danger btn-xs' style='margin-left:1vw' ng-click='open(lg, { "log": date })' ng-controller='DeleteFieldModalCtrl'>
                                        Delete
                                    </button>
                                </form>
                            </div>
                        </td>
                        <td ng-repeat='asset in assets | orderBy:"id"'>
                            <ul ng-repeat="log in asset.logs" ng-if='log.weekOf === date' class='log'>
                                <li ng-repeat='(field, value) in log.data'>
                                    <span ng-show='logform.$visible'>
                                        {{ field }}: 
                                    </span>
                                    <span editable-text='log.data.{{ field }}' e-name='{{ field }}' e-form='logform'>
                                        {{ field }}: {{ value }}
                                    </span>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>